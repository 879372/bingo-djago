<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartelas de Bingo</title>
    <style>
        table {
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
        }
        .destaque {
            background-color: yellow; /* Defina aqui o estilo de destaque desejado */
        }
        .modal {
            display: none; /* Inicialmente oculto */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        /* Botão de fechar do modal */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Cartelas de Bingo</h1>
    <p>{{ cartela_kuadra }}</p>
    <p>{{ cartela_kina }}</p>
    <p>{{ cartela_keno }}</p>
    <p>{{ cartela_keno.sorteio }}</p>
    {% if sorteio_kuadra %}
    <p>Sorteio da Kuadra: {{ sorteio_kuadra }}</p>
    {% endif %}

    {% if sorteio_kina %}
        <p>Sorteio da Kina: {{ sorteio_kina }}</p>
    {% endif %}

    {% if sorteio_keno %}
        <p>Sorteio do Keno: {{ sorteio_keno }}</p>
    {% endif %}

    <ul id="index"></ul>

    {% for cartela in cartelas %}
        <h2>Cartela {{ cartela.pk }}</h2>
        <table class="numeros-cartela"> <!-- Adiciona a classe numeros-cartela à tabela -->
            <tr>
                <th>B</th><th>I</th><th>N</th><th>G</th><th>O</th>
            </tr>
            <tr>
                {% for numero in cartela.numeros_gerados %}
                    {% if forloop.counter0|divisibleby:5 and not forloop.first %}
                        </tr><tr>
                    {% endif %}
                    <!-- Adicione a verificação e a classe de destaque aqui -->
                    <td>{{ numero }}</td>
                {% endfor %}
            </tr>
        </table>
    {% endfor %}
    <h2 id="numeros-sorteados">Números Sorteados</h2>
    <ul id="lista-numeros-sorteados"></ul>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <!-- Conteúdo do modal -->
        <div class="modal-content">
            <p id="modal-text"></p>
        </div>
    </div>

    <script>
    
        function verificarNumerosSorteados(numerosSorteados) {
            var numerosCartelas = document.querySelectorAll('.numeros-cartela td');
            var intervalo = 1000; // Intervalo de 1 segundo
    
            var i = 0;
            var interval = setInterval(function () {
                if (i >= numerosSorteados.length) {
                    clearInterval(interval); // Interrompe o intervalo quando todos os números foram verificados
                    return;
                }
    
                var numeroAtual = numerosSorteados[i];
                for (var j = 0; j < numerosCartelas.length; j++) {
                    var numeroCartela = parseInt(numerosCartelas[j].innerText);
                    if (numeroCartela === numeroAtual) {
                        numerosCartelas[j].classList.add('destaque');
                    }
                }
                //enviarNumeroSorteado(numeroAtual);
                i++;
            }, intervalo);
        }

        function atualizarNumeros(numeros, sorteioKuadra, sorteioKina, sorteioKeno) {
            var ul = document.getElementById('lista-numeros-sorteados');
            ul.innerHTML = ''; // Limpa a lista antes de adicionar os novos números
    
            numeros.forEach(function (numero, index) {
                setTimeout(function () {
                    var li = document.createElement('li');
                    var indexx = index + 1;
                    li.textContent = 'Índice: ' + indexx + ' - Número: ' + numero;
                    ul.appendChild(li);
                    verificarNumerosSorteados([numero]);
                    
                    // Verifica se o índice do número sorteado corresponde ao sorteio da Kuadra
                    if (indexx === sorteioKuadra) {
                        openModal('kuadra');
                    } else if (indexx === sorteioKina){
                        openModal('kina')
                    } else if (indexx === sorteioKeno){
                        openModal('keno')
                    }
                }, index * 1000);
            });
        }
            // Função para abrir o modal
            function openModal(text) {
                var modal = document.getElementById("myModal");
                var modalText = document.getElementById("modal-text");
    
                // Define o conteúdo do modal com base no tipo de sorteio
                if (text === 'kuadra') {
                    modalText.innerHTML = "{{ cartela_kuadra }}";
                } else if (text === 'kina') {
                    modalText.innerHTML = "{{ cartela_kina }}";
                } else if (text === 'keno') {
                    modalText.innerHTML = "{{ cartela_keno }}";
                } else {
                    modalText.innerHTML = "Sorteio!";
                }
    
                modal.style.display = "block"; // Exibe o modal
    
                // Fecha o modal após 5 segundos
                setTimeout(function(){
                    modal.style.display = "none";
                }, 5000);
            }
    
        //var csrftoken = getCookie('csrftoken');
        atualizarNumeros({{ numeros_sorteados }}, {{ sorteio_kuadra }}, {{ sorteio_kina}}, {{sorteio_keno}});
    </script>

</body>
</html>
