<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartelas de Bingo</title>
    <style>
        table {
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 5px;
            text-align: center;
        }
        .destaque {
            background-color: yellow; /* Defina aqui o estilo de destaque desejado */
        }
        .modal {
            display: none; /* Inicialmente oculto */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        /* Botão de fechar do modal */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Cartelas de Bingo</h1>
    <p>{{ cartela_kuadra }}</p>
    <p>{{ cartela_kina }}</p>
    <p>{{ cartela_keno }}</p>

    {% if sorteio_kuadra %}
    <p>Sorteio da Kuadra: {{ sorteio_kuadra }}</p>
    {% endif %}

    {% if sorteio_kina %}
        <p>Sorteio da Kina: {{ sorteio_kina }}</p>
    {% endif %}

    {% if sorteio_keno %}
        <p>Sorteio do Keno: {{ sorteio_keno }}</p>
    {% endif %}

    <ul id="index"></ul>

    {% for cartela in cartelas %}
        <h2>Cartela {{ cartela.pk }}</h2>
        <table class="numeros-cartela"> <!-- Adiciona a classe numeros-cartela à tabela -->
            <tr>
                <th>B</th><th>I</th><th>N</th><th>G</th><th>O</th>
            </tr>
            <tr>
                {% for numero in cartela.numeros_gerados %}
                    {% if forloop.counter0|divisibleby:5 and not forloop.first %}
                        </tr><tr>
                    {% endif %}
                    <!-- Adicione a verificação e a classe de destaque aqui -->
                    <td>{{ numero }}</td>
                {% endfor %}
            </tr>
        </table>
    {% endfor %}
    <h2 id="numeros-sorteados">Números Sorteados</h2>
    <ul id="lista-numeros-sorteados"></ul>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <!-- Conteúdo do modal -->
        <div class="modal-content">
            <p id="modal-text"></p>
        </div>
    </div>

    <script>
        var paused = false;
        var timeoutId = null;
        var currentIndex = 0;
        var numerosGlobais = [];
        var sorteioKuadra, sorteioKina, sorteioKeno;

        function verificarNumerosSorteados(numerosSorteados) {
            var numerosCartelas = document.querySelectorAll('.numeros-cartela td');
    
            var numeroAtual = numerosSorteados[0];
            for (var j = 0; j < numerosCartelas.length; j++) {
                var numeroCartela = parseInt(numerosCartelas[j].innerText);
                if (numeroCartela === numeroAtual) {
                    numerosCartelas[j].classList.add('destaque');
                }
            }
        }

        function atualizarNumeros(numeros, kuadra, kina, keno) {
            numerosGlobais = numeros;
            sorteioKuadra = kuadra;
            sorteioKina = kina;
            sorteioKeno = keno;
            currentIndex = 0;
            processarProximoNumero();
        }

        function processarProximoNumero() {
            if (currentIndex >= numerosGlobais.length) {
                return; // Termina quando todos os números foram processados
            }

            if (paused) {
                return; // Pausa a execução se necessário
            }

            var ul = document.getElementById('lista-numeros-sorteados');
            var numero = numerosGlobais[currentIndex];
            var li = document.createElement('li');
            li.textContent = 'Índice: ' + (currentIndex + 1) + ' - Número: ' + numero;
            ul.appendChild(li);
            verificarNumerosSorteados([numero]);
            
            // Verifica se o índice do número sorteado corresponde ao sorteio da Kuadra
            if (currentIndex + 1 === sorteioKuadra) {
                openModal('kuadra');
            } else if (currentIndex + 1 === sorteioKina){
                openModal('kina')
            } else if (currentIndex + 1 === sorteioKeno){
                openModal('keno')
            }

            currentIndex++;
            timeoutId = setTimeout(processarProximoNumero, 1000);
        }

        function openModal(text) {
            paused = true;
            clearTimeout(timeoutId);

            var modal = document.getElementById("myModal");
            var modalText = document.getElementById("modal-text");

            if (text === 'kuadra') {
                modalText.innerHTML = "{{ cartela_kuadra }}";
            } else if (text === 'kina') {
                modalText.innerHTML = "{{ cartela_kina }}";
            } else if (text === 'keno') {
                modalText.innerHTML = "{{ cartela_keno }}";
                // Após informar o sorteio do Keno, exibe o ranking de vencedores
                setTimeout(exibirRanking, 5000);
            } else {
                modalText.innerHTML = "Sorteio!";
            }

            modal.style.display = "block";

            if (text !== 'keno') {
                setTimeout(closeModal, 5000);
            }
        }

        // Exibe o ranking de vencedores de Kuadra, Kina e Keno
        function exibirRanking() {
            // Exibir o ranking no modal
            var modalText = document.getElementById("modal-text");
            modalText.innerHTML = "Ranking de Vencedores:<br>Kuadra: " + "{{ cartela_kuadra }}" + "<br>Kina: " + "{{ cartela_kina }}" + "<br>Keno: " + "{{ cartela_keno }}";
        }

        // Função para calcular o vencedor de uma categoria (Kuadra, Kina, Keno)
        function calcularVencedor(numeroSorteado, categoria) {
            var vencedor = 'Nenhum';
            var numerosCartelas = document.querySelectorAll('.numeros-cartela td');

            for (var j = 0; j < numerosCartelas.length; j++) {
                var numeroCartela = parseInt(numerosCartelas[j].innerText);
                if (numeroCartela === numeroSorteado) {
                    // Aqui você pode implementar a lógica para determinar o vencedor com base na categoria
                    vencedor = 'Jogador ' + (j + 1); // Apenas um exemplo básico
                    break;
                }
            }

            return vencedor;
        }

        // Função para fechar o modal e continuar o sorteio
        function closeModal() {
            var modal = document.getElementById("myModal");
            modal.style.display = "none";
            paused = false;
            processarProximoNumero();
        }

        // Inicia o sorteio dos números
        atualizarNumeros({{ numeros_sorteados }}, {{ sorteio_kuadra }}, {{ sorteio_kina }}, {{ sorteio_keno }});
    </script>

</body>
</html>

